<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CAWT ESCAPE ROOM</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: 'Courier New', Courier, monospace;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    #game, #map, #timer, #wrongDisplay, #clueBtn, #clueCounter, #roomInfo, #lockIcon, #story, #intro {
      position: absolute;
      padding: 10px;
      z-index: 2;
    }
    #game {
      top: 25%;
      left: 10%;
      right: 10%;
      text-align: center;
      display: none; /* Hidden during intro */
    }
    #story {
      top: 20%;
      left: 10%;
      right: 10%;
      font-size: 1.4em;
      color: #f33;
      text-shadow: 0 0 10px red;
      animation: glitch 2s infinite;
      max-width: 80%;
      margin: auto;
      user-select: none;
      display: none;
    }
    #timer {
      top: 0;
      right: 0;
      display: none; /* Hidden during intro */
    }
    #clueCounter {
      top: 0;
      left: 0;
      display: none; /* Hidden during intro */
    }
    #wrongDisplay {
      top: 40%;
      left: 30%;
      font-size: 5em;
      color: red;
      display: none;
      text-shadow: 0 0 10px red;
      font-weight: bold;
      animation: glitch 1s infinite;
      user-select: none;
    }
    #roomInfo {
      top: 55%;
      left: 50%;
      transform: translateX(-50%);
      color: #f00;
      font-size: 1.3em;
      max-width: 80%;
      text-align: center;
      filter: drop-shadow(0 0 3px red);
      animation: glitch 2s infinite;
      display: none; /* Hidden during intro */
    }
    #lockIcon {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 5em;
      display: none;
      text-shadow: 0 0 20px red;
      user-select: none;
    }
    #inputArea {
      position: absolute;
      bottom: 5%;
      left: 10%;
      right: 10%;
      display: none; /* Hidden during intro */
      gap: 10px;
      align-items: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      background: #222;
      color: white;
      border: 1px solid #444;
      transition: box-shadow 0.3s ease-in-out;
    }
    input[type="text"]:focus {
      outline: none;
      background: #222;
      color: white;
    }
    .input-error {
      box-shadow: 0 0 8px 3px red;
      animation: glitch 0.3s infinite;
    }
    button {
      padding: 10px 20px;
      background: #c00;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    button.choice {
      background: #222;
      border: 2px solid #c00;
      font-weight: normal;
      font-size: 1.2em;
      flex: none;
      padding: 10px 15px;
      transition: background 0.3s, color 0.3s;
    }
    button.choice:hover {
      background: #c00;
      color: white;
    }
    .glitch {
      animation: glitch 1s infinite;
    }
    @keyframes glitch {
      0% { text-shadow: 2px 0 red, -2px 0 blue; }
      20% { text-shadow: -2px 0 red, 2px 0 blue; }
      40% { text-shadow: 2px 2px red, -2px -2px blue; }
      60% { text-shadow: -2px 2px red, 2px -2px blue; }
      80% { text-shadow: 2px -2px red, -2px 2px blue; }
      100% { text-shadow: -2px 0 red, 2px 0 blue; }
    }
    h2 {
      font-size: 2.5em;
      color: #f00;
      text-shadow: 0 0 10px red, 0 0 20px red;
      margin-bottom: 0.3em;
    }
    p {
      font-size: 1.5em;
      color: #ddd;
      text-shadow: 1px 1px 5px #f00, -1px -1px 5px #000;
      filter: contrast(1.2) brightness(1.1);
      animation: glitch 2s infinite;
      margin-top: 0.3em;
    }
    /* Intro styles */
    #intro {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #111;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #intro-title {
      font-size: 4em;
      color: #f00;
      text-shadow: 0 0 15px red, 0 0 30px red;
      animation: glitch 1.5s infinite;
      margin-bottom: 20px;
    }
    #intro-loader {
      width: 60px;
      height: 60px;
      border: 8px solid #f00;
      border-top: 8px solid #111;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
    }
    #intro-story {
      font-size: 1.5em;
      color: #ddd;
      text-shadow: 1px 1px 5px #f00;
      max-width: 80%;
      text-align: center;
      animation: glitch 2s infinite;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="intro">
    <div id="intro-title">CAWT ESCAPE ROOM</div>
    <div id="intro-loader"></div>
    <div id="intro-story">
      You wandered too far into the abandoned manor, lured by whispers of forgotten secrets. A cold wind slammed the door shut behind you, and the walls pulsed with an eerie glow. Trapped in a maze of riddles, your only escape is to solve the mysteries within... or remain forever in the shadows.
    </div>
  </div>
  <div id="timer"></div>
  <div id="clueCounter">üîç Clues: <span id="clueCount">0</span></div>
  <div id="story" style="display:none;"></div>
  <div id="game" class="glitch"></div>
  <div id="roomInfo"></div>
  <div id="wrongDisplay">WRONG</div>
  <div id="lockIcon">üîì</div>
  <div id="inputArea">
    <input type="text" id="answerInput" placeholder="Type your answer..." autocomplete="off" />
    <button onclick="submitAnswer()">Submit</button>
    <button id="clueBtn" onclick="getClue()">Get Clue</button>
  </div>

<script>
  const game = document.getElementById('game');
  const timer = document.getElementById('timer');
  const wrongDisplay = document.getElementById('wrongDisplay');
  const answerInput = document.getElementById('answerInput');
  const clueCountDisplay = document.getElementById('clueCount');
  const lockIcon = document.getElementById('lockIcon');
  const roomInfo = document.getElementById('roomInfo');
  const inputArea = document.getElementById('inputArea');
  const clueBtn = document.getElementById('clueBtn');
  const storyDiv = document.getElementById('story');
  const intro = document.getElementById('intro');
  const introTitle = document.getElementById('intro-title');
  const introLoader = document.getElementById('intro-loader');
  const introStory = document.getElementById('intro-story');

  let currentRoom = 0;
  const totalRooms = 30;
  const startTime = Date.now();
  let clues = 0;
  let wrongTries = 0;
  let clueButtonClicksWithoutClues = 0;
  let storyTimeout = null;

  // Riddles array (unchanged from previous version)
  const riddles = [
    {
      question: "The more you take, the more you leave behind. What am I?",
      answer: "footprint",
      clue: "Your steps create me.",
      story: "The floor creaks beneath your feet in this shadowed chamber, each step leaving a trace that lingers in the dust..."
    },
    {
      question: "I fly without wings, I cry without eyes. Darkness follows me. What am I?",
      answer: "cloud",
      clue: "I bring rain and shade.",
      story: "A cold wind swirls through the room, and above, a form drifts, weeping silently as shadows trail in its wake..."
    },
    {
      question: "I have cities but no houses, forests but no trees, and rivers but no water. What am I?",
      answer: "map",
      clue: "I guide without moving.",
      story: "An ancient parchment lies on a stone table, its faded lines depicting places that exist only in ink..."
    },
    {
      question: "I‚Äôm tall when I‚Äôm young, and short when I‚Äôm old. What am I?",
      answer: "candle",
      clue: "I burn to give light.",
      story: "A flickering flame casts eerie shadows, its waxen form dwindling as it illuminates the cold stone walls..."
    },
    {
      question: "I have branches, but no fruit, trunk, or leaves. What am I?",
      answer: "bank",
      clue: "I hold wealth, not plants.",
      story: "A vaulted chamber echoes with the clink of coins, its walls lined with ledgers of forgotten transactions..."
    },
    {
      question: "What can travel around the world while staying in a corner?",
      answer: "stamp",
      clue: "I‚Äôm small and sticky.",
      story: "A tattered envelope lies in the corner, its small square mark whispering of journeys across distant lands..."
    },
    {
      question: "I‚Äôm light as a feather, yet the strongest cannot hold me for long. What am I?",
      answer: "breath",
      clue: "You need me to live.",
      story: "The air grows thin in this suffocating room, each gasp a reminder of something fleeting yet vital..."
    },
    {
      question: "What begins with T, ends with T, and has T in it?",
      answer: "teapot",
      clue: "I pour a warm drink.",
      story: "A chipped teapot sits on a dusty table, its spout hinting at long-forgotten gatherings in this forsaken place..."
    },
    {
      question: "I‚Äôm always in front of you, but you can never see me. What am I?",
      answer: "future",
      clue: "I‚Äôm time yet to come.",
      story: "A clock ticks backward, its hands pointing to moments unseen, as whispers of tomorrow fill the air..."
    },
    {
      question: "What has one eye but cannot see?",
      answer: "needle",
      clue: "I pierce fabric.",
      story: "A glinting needle lies on a tattered cloth, its single eye blind to the threads it binds..."
    },
    {
      question: "The poor have me, the rich need me, and if you eat me, you‚Äôll die. What am I?",
      answer: "nothing",
      clue: "I‚Äôm the absence of all.",
      story: "An empty void greets you, a room so bare it feels like the absence itself is watching..."
    },
    {
      question: "What runs all around a house but never moves?",
      answer: "fence",
      clue: "I guard the perimeter.",
      story: "Rusty iron bars encircle the room, standing sentinel, immovable yet ever-present..."
    },
    {
      question: "I‚Äôm full of holes, yet I hold water. What am I?",
      answer: "sponge",
      clue: "I clean with my pores.",
      story: "A damp, porous object rests in a puddle, soaking up the room‚Äôs secrets with its countless voids..."
    },
    {
      question: "What has a heart that doesn‚Äôt beat?",
      answer: "artichoke",
      clue: "I‚Äôm a vegetable.",
      story: "A strange plant lies in the corner, its core still and silent, yet named for a living thing..."
    },
    {
      question: "I‚Äôm taken from a mine and shut in a wooden case, never released, yet used by many. What am I?",
      answer: "pencil",
      clue: "I write without ink.",
      story: "A worn pencil rolls across a desk, its core of earth trapped forever, leaving marks for all who wield it..."
    },
    {
      question: "What can be broken without being touched?",
      answer: "promise",
      clue: "Words create and break me.",
      story: "Whispers of broken oaths echo in the chamber, their weight heavier than any stone..."
    },
    {
      question: "I‚Äôm always running but never move. What am I?",
      answer: "clock",
      clue: "I measure time‚Äôs passage.",
      story: "A ticking fills the room, as a clock‚Äôs hands chase time endlessly, yet remain fixed in place..."
    },
    {
      question: "What has a mouth but never speaks?",
      answer: "river",
      clue: "I flow with water.",
      story: "A faint gurgle echoes from a carved stone mouth, its silent waters rushing through the dark..."
    },
    {
      question: "I‚Äôm seen in water, but I‚Äôm not wet. What am I?",
      answer: "reflection",
      clue: "I mirror your face.",
      story: "A still pool in the floor shows your face, a perfect image untouched by the water‚Äôs chill..."
    },
    {
      question: "What has four legs in the morning, two at noon, and three in the evening?",
      answer: "human",
      clue: "I‚Äôm you, through life.",
      story: "A shadow moves across the wall, its form shifting with the stages of a life‚Äôs journey..."
    },
    {
      question: "I‚Äôm weightless, but you can see me. Put me in a bucket, and I‚Äôll make it lighter. What am I?",
      answer: "hole",
      clue: "I‚Äôm an absence you see.",
      story: "A gaping void in the floor stares back, lightening all that holds it, yet visible to all..."
    },
    {
      question: "What speaks without a mouth and hears without ears?",
      answer: "echo",
      clue: "I repeat what you say.",
      story: "Your voice bounces off the walls, a ghostly reply mimicking your words from the shadows..."
    },
    {
      question: "If two‚Äôs company and three‚Äôs a crowd, what are four and five?",
      answer: "nine",
      clue: "Add them together.",
      story: "Numbers glow faintly on the wall, their sum forming a key to the next chamber..."
    },
    {
      question: "What is so fragile that saying its name breaks it?",
      answer: "silence",
      clue: "Quiet is my essence.",
      story: "The room is deathly still, but a single sound shatters the fragile peace within..."
    },
    {
      question: "I‚Äôm not alive, but I grow; I don‚Äôt have lungs, but I need air. What am I?",
      answer: "fire",
      clue: "I consume to exist.",
      story: "A faint ember glows in the hearth, hungry for air, growing with each breath it steals..."
    },
    {
      question: "What has a thumb but no fingers?",
      answer: "glove",
      clue: "I cover your hand.",
      story: "A tattered glove lies discarded, its thumb empty, waiting for a hand to fill it..."
    },
    {
      question: "I‚Äôm where the earth and sky appear to meet, yet you can never reach me. What am I?",
      answer: "horizon",
      clue: "I‚Äôm always distant.",
      story: "A window shows a line where earth and sky converge, forever out of reach, taunting your escape..."
    },
    {
      question: "What can you catch but not throw?",
      answer: "cold",
      clue: "It‚Äôs an illness.",
      story: "A chill seeps into your bones, an invisible affliction caught in the damp air of this cursed room..."
    },
    {
      question: "I‚Äôm born of incantation, sustained by attention, and die when ignored. What am I?",
      answer: "spell",
      clue: "Magic gives me life.",
      story: "Runes glow faintly on the walls, their power fading unless your focus keeps them alive..."
    },
    {
      question: "What is the next letter in this sequence: J, K, I, M, I, ?, I?",
      answer: "I",
      clue: "Look for a pattern in letters.",
      story: "Carved letters spiral across the ceiling, their sequence a puzzle locking the door ahead..."
    }
  ];

  // Intro sequence timing
  function startIntro() {
    // Initially hide game elements
    game.style.display = 'none';
    timer.style.display = 'none';
    clueCounter.style.display = 'none';
    roomInfo.style.display = 'none';
    inputArea.style.display = 'none';
    storyDiv.style.display = 'none';

    // Show title for 3 seconds
    introTitle.style.display = 'block';
    setTimeout(() => {
      introTitle.style.display = 'none';
      introLoader.style.display = 'block';
      // Show loader for 3 seconds
      setTimeout(() => {
        introLoader.style.display = 'none';
        introStory.style.display = 'block';
        // Show story for 20 seconds
        setTimeout(() => {
          intro.style.animation = 'glitch 0.5s infinite';
          // Glitch for 4 seconds, then start game
          setTimeout(() => {
            intro.style.display = 'none';
            game.style.display = 'block';
            timer.style.display = 'block';
            clueCounter.style.display = 'block';
            roomInfo.style.display = 'block';
            inputArea.style.display = 'flex';
            displayRoom();
          }, 4000);
        }, 20000);
      }, 3000);
    }, 3000);
  }

  setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    timer.textContent = `‚è±Ô∏è Time: ${minutes}m ${seconds}s`;
  }, 1000);

  function showWrongEffect() {
    wrongDisplay.style.display = 'block';
    document.body.style.backgroundColor = '#300';
    setTimeout(() => {
      wrongDisplay.style.display = 'none';
      document.body.style.backgroundColor = '#111';
    }, 1500);
  }

  function showInputError() {
    answerInput.classList.add('input-error');
    setTimeout(() => answerInput.classList.remove('input-error'), 3000);
  }

  function showLock() {
    lockIcon.style.display = 'block';
    setTimeout(() => {
      lockIcon.style.display = 'none';
    }, 1500);
  }

  function showJumpScare() {
    const jump = document.createElement('div');
    jump.style.position = 'fixed';
    jump.style.top = '0';
    jump.style.left = '0';
    jump.style.right = '0';
    jump.style.bottom = '0';
    jump.style.background = 'url(https://i.imgur.com/OuLE1gK.png) center center / cover no-repeat';
    jump.style.zIndex = '9999';
    jump.style.animation = 'glitch 0.5s infinite';
    document.body.appendChild(jump);
    setTimeout(() => {
      document.body.removeChild(jump);
    }, 1000);
  }

  function showStoryThenRiddle() {
    inputArea.style.display = 'none';
    clueBtn.disabled = true;
    game.style.display = 'none';
    roomInfo.style.display = 'none';

    const riddle = riddles[currentRoom % riddles.length];
    storyDiv.style.display = 'block';
    storyDiv.textContent = riddle.story;

    if (storyTimeout) clearTimeout(storyTimeout);
    storyTimeout = setTimeout(() => {
      storyDiv.style.display = 'none';
      game.style.display = 'block';
      roomInfo.style.display = 'block';
      clueBtn.disabled = false;
      displayRiddle();
    }, 10000);
  }

  function displayRiddle() {
    const riddle = riddles[currentRoom % riddles.length];
    roomInfo.textContent = `üï≥ You feel a chill... Room ${currentRoom + 1} awaits.`;

    let html = `<h2>Room ${currentRoom + 1}</h2><p>${riddle.question}</p>`;

    if (riddle.choices && riddle.choices.length) {
      inputArea.style.display = 'none';
      game.innerHTML = html + '<div id="choicesContainer" style="margin-top:20px;"></div>';

      const choicesContainer = document.getElementById('choicesContainer');
      choicesContainer.innerHTML = '';
      riddle.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.textContent = choice;
        btn.className = 'choice';
        btn.onclick = () => checkAnswer(choice);
        choicesContainer.appendChild(btn);
      });
    } else {
      inputArea.style.display = 'flex';
      game.innerHTML = html;
    }
    answerInput.value = '';
    answerInput.focus();
  }

  function displayRoom() {
    if (currentRoom >= totalRooms) {
      game.innerHTML = `<h1>üéâ You escaped all ${totalRooms} rooms!</h1><p>${timer.textContent}</p>`;
      inputArea.style.display = 'none';
      roomInfo.textContent = '';
      storyDiv.style.display = 'none';
      return;
    }
    showStoryThenRiddle();
  }

  function checkAnswer(input) {
    const answer = input.trim().toLowerCase();
    const correct = riddles[currentRoom % riddles.length].answer.toLowerCase();

    if (!answer) {
      showInputError();
      return;
    }

    if (answer === correct) {
      wrongTries = 0;
      currentRoom++;
      if (currentRoom % 2 === 0) clues++;
      clueCountDisplay.textContent = clues;
      showLock();
      displayRoom();
    } else {
      wrongTries++;
      if (wrongTries >= 3) {
        alert(`ü§´ Hint: ${riddles[currentRoom % riddles.length].answer}`);
      }
      showWrongEffect();
      if (Math.random() < 0.3) {
        showJumpScare();
      }
    }
  }

  function submitAnswer() {
    checkAnswer(answerInput.value);
  }

  function getClue() {
    if (clues > 0) {
      clues--;
      clueCountDisplay.textContent = clues; // Fixed from 'clocks'
      clueButtonClicksWithoutClues = 0;
      alert(`üïØ Clue: ${riddles[currentRoom % riddles.length].clue}`);
    } else {
      clueButtonClicksWithoutClues++;
      if (clueButtonClicksWithoutClues > 3) {
        alert(`üí° Answer: ${riddles[currentRoom % riddles.length].answer}`);
        clueButtonClicksWithoutClues = 0;
      } else {
        alert("‚ùå You have no clues left! Press again 3 times to reveal answer.");
      }
    }
  }

  // Start the intro sequence instead of directly displaying the first room
  startIntro();

</script>
</body>
</html>
