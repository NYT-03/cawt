<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CAWT ESCAPE ROOM</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: 'Courier New', Courier, monospace;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    #game, #map, #timer, #wrongDisplay, #clueBtn, #clueCounter, #roomInfo, #lockIcon, #story {
      position: absolute;
      padding: 10px;
      z-index: 2;
    }
    #game {
      top: 25%;
      left: 10%;
      right: 10%;
      text-align: center;
    }
    #story {
      top: 20%;
      left: 10%;
      right: 10%;
      font-size: 1.4em;
      color: #f33;
      text-shadow: 0 0 10px red;
      animation: glitch 2s infinite;
      max-width: 80%;
      margin: auto;
      user-select: none;
    }
    #timer {
      top: 0;
      right: 0;
    }
    #clueCounter {
      top: 0;
      left: 0;
    }
    #wrongDisplay {
      top: 40%;
      left: 30%;
      font-size: 5em;
      color: red;
      display: none;
      text-shadow: 0 0 10px red;
      font-weight: bold;
      animation: glitch 1s infinite;
      user-select: none;
    }
    #roomInfo {
      top: 55%;
      left: 50%;
      transform: translateX(-50%);
      color: #f00;
      font-size: 1.3em;
      max-width: 80%;
      text-align: center;
      filter: drop-shadow(0 0 3px red);
      animation: glitch 2s infinite;
    }
    #lockIcon {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 5em;
      display: none;
      text-shadow: 0 0 20px red;
      user-select: none;
    }
    #inputArea {
      position: absolute;
      bottom: 5%;
      left: 10%;
      right: 10%;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      background: #222;
      color: white;
      border: 1px solid #444;
      transition: box-shadow 0.3s ease-in-out;
    }
    input[type="text"]:focus {
      outline: none;
      background: #222;
      color: white;
    }
    .input-error {
      box-shadow: 0 0 8px 3px red;
      animation: glitch 0.3s infinite;
    }
    button {
      padding: 10px 20px;
      background: #c00;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }
    button.choice {
      background: #222;
      border: 2px solid #c00;
      font-weight: normal;
      font-size: 1.2em;
      flex: none;
      padding: 10px 15px;
      transition: background 0.3s, color 0.3s;
    }
    button.choice:hover {
      background: #c00;
      color: white;
    }
    .glitch {
      animation: glitch 1s infinite;
    }
    @keyframes glitch {
      0% { text-shadow: 2px 0 red, -2px 0 blue; }
      20% { text-shadow: -2px 0 red, 2px 0 blue; }
      40% { text-shadow: 2px 2px red, -2px -2px blue; }
      60% { text-shadow: -2px 2px red, 2px -2px blue; }
      80% { text-shadow: 2px -2px red, -2px 2px blue; }
      100% { text-shadow: -2px 0 red, 2px 0 blue; }
    }
    h2 {
      font-size: 2.5em;
      color: #f00;
      text-shadow: 0 0 10px red, 0 0 20px red;
      margin-bottom: 0.3em;
    }
    p {
      font-size: 1.5em;
      color: #ddd;
      text-shadow: 1px 1px 5px #f00, -1px -1px 5px #000;
      filter: contrast(1.2) brightness(1.1);
      animation: glitch 2s infinite;
      margin-top: 0.3em;
    }
  </style>
</head>
<body>
  <div id="timer"></div>
  <div id="clueCounter">üîç Clues: <span id="clueCount">0</span></div>
  <div id="story" style="display:none;"></div>
  <div id="game" class="glitch"></div>
  <div id="roomInfo"></div>
  <div id="wrongDisplay">WRONG</div>
  <div id="lockIcon">üîì</div>
  <div id="inputArea">
    <input type="text" id="answerInput" placeholder="Type your answer..." autocomplete="off" />
    <button onclick="submitAnswer()">Submit</button>
    <button id="clueBtn" onclick="getClue()">Get Clue</button>
  </div>

<script>
  const game = document.getElementById('game');
  const timer = document.getElementById('timer');
  const wrongDisplay = document.getElementById('wrongDisplay');
  const answerInput = document.getElementById('answerInput');
  const clueCountDisplay = document.getElementById('clueCount');
  const lockIcon = document.getElementById('lockIcon');
  const roomInfo = document.getElementById('roomInfo');
  const inputArea = document.getElementById('inputArea');
  const clueBtn = document.getElementById('clueBtn');
  const storyDiv = document.getElementById('story');

  let currentRoom = 0;
  const totalRooms = 50;
  const startTime = Date.now();
  let clues = 0;
  let wrongTries = 0;
  let clueButtonClicksWithoutClues = 0;
  let storyTimeout = null;

  // Riddles with related stories
  const riddles = [
    {
      question: "What has keys but can't open locks?",
      answer: "keyboard",
      clue: "Used in every room, lies in front of you.",
      story: "You find yourself in a dimly lit chamber. The walls hum softly, and a faint glow from a strange device catches your eye. It has many keys but none to open a door..."
    },
    {
      question: "What has hands but can't clap?",
      answer: "clock",
      clue: "Time ticks in silence above.",
      story: "A chilling silence fills the air as you see a clock hanging crookedly on the wall, its hands frozen yet impossibly moving in your mind..."
    },
    {
      question: "What gets wetter the more it dries?",
      answer: "towel",
      clue: "It helps after showers.",
      story: "You enter a damp room, the scent of fresh water lingering. A soft fabric hangs nearby, promising to dry what it touches, yet it itself becomes soaked."
    },
    {
      question: "What can fill a room but takes up no space?",
      answer: "light",
      clue: "It shines but weighs nothing.",
      story: "Darkness surrounds you, but a sudden flicker of brightness fills the chamber, making shadows retreat and revealing the path ahead."
    },
    {
      question: "What has a neck but no head?",
      answer: "bottle",
      clue: "Found in kitchens, holds liquid.",
      story: "You see an ancient bottle resting on a dusty shelf, its slender neck stretched towards an unseen ceiling."
    },
    {
      question: "Which number comes next: 2, 4, 6, ?",
      answer: "8",
      clue: "It's the next even number.",
      story: "A sequence of numbers glows on the floor: 2, 4, 6... The pattern beckons you to find what follows."
    },
    {
      question: "What color do you get when you mix red and white?",
      answer: "pink",
      clue: "It's a lighter shade of red.",
      story: "A palette of colors swirls before you, merging shades to create something soft and delicate."
    }
  ];

  setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    timer.textContent = `‚è±Ô∏è Time: ${minutes}m ${seconds}s`;
  }, 1000);

  function showWrongEffect() {
    wrongDisplay.style.display = 'block';
    document.body.style.backgroundColor = '#300';
    setTimeout(() => {
      wrongDisplay.style.display = 'none';
      document.body.style.backgroundColor = '#111';
    }, 1500);
  }

  function showInputError() {
    answerInput.classList.add('input-error');
    setTimeout(() => answerInput.classList.remove('input-error'), 3000);
  }

  function showLock() {
    lockIcon.style.display = 'block';
    setTimeout(() => {
      lockIcon.style.display = 'none';
    }, 1500);
  }

  function showJumpScare() {
    const jump = document.createElement('div');
    jump.style.position = 'fixed';
    jump.style.top = '0';
    jump.style.left = '0';
    jump.style.right = '0';
    jump.style.bottom = '0';
    jump.style.background = 'url(https://i.imgur.com/OuLE1gK.png) center center / cover no-repeat';
    jump.style.zIndex = '9999';
    jump.style.animation = 'glitch 0.5s infinite';
    document.body.appendChild(jump);
    setTimeout(() => {
      document.body.removeChild(jump);
    }, 1000);
  }

  function showStoryThenRiddle() {
    // Disable input and clue button during story
    inputArea.style.display = 'none';
    clueBtn.disabled = true;
    game.style.display = 'none';
    roomInfo.style.display = 'none';

    const riddle = riddles[currentRoom % riddles.length];
    storyDiv.style.display = 'block';
    storyDiv.textContent = riddle.story;

    if (storyTimeout) clearTimeout(storyTimeout);
    storyTimeout = setTimeout(() => {
      storyDiv.style.display = 'none';
      game.style.display = 'block';
      roomInfo.style.display = 'block';
      clueBtn.disabled = false;
      displayRiddle();
    }, 10000);
  }

  function displayRiddle() {
    const riddle = riddles[currentRoom % riddles.length];
    roomInfo.textContent = `üï≥ You feel a chill... Room ${currentRoom + 1} awaits.`;

    let html = `<h2>Room ${currentRoom + 1}</h2><p>${riddle.question}</p>`;

    if (riddle.choices && riddle.choices.length) {
      // multiple choice room
      inputArea.style.display = 'none';
      game.innerHTML = html + '<div id="choicesContainer" style="margin-top:20px;"></div>';

      const choicesContainer = document.getElementById('choicesContainer');
      choicesContainer.innerHTML = '';
      riddle.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.textContent = choice;
        btn.className = 'choice';
        btn.onclick = () => checkAnswer(choice);
        choicesContainer.appendChild(btn);
      });
    } else {
      inputArea.style.display = 'flex';
      game.innerHTML = html;
    }
    answerInput.value = '';
    answerInput.focus();
  }

  function displayRoom() {
    if (currentRoom >= totalRooms) {
      game.innerHTML = `<h1>üéâ You escaped all ${totalRooms} rooms!</h1><p>${timer.textContent}</p>`;
      inputArea.style.display = 'none';
      roomInfo.textContent = '';
      storyDiv.style.display = 'none';
      return;
    }
    showStoryThenRiddle();
  }

  function checkAnswer(input) {
    const answer = input.trim().toLowerCase();
    const correct = riddles[currentRoom % riddles.length].answer.toLowerCase();

    if (!answer) {
      showInputError();
      return;
    }

    if (answer === correct) {
      wrongTries = 0;
      currentRoom++;
      if (currentRoom % 2 === 0) clues++;
      clueCountDisplay.textContent = clues;
      showLock();
      displayRoom();
    } else {
      wrongTries++;
      if (wrongTries >= 3) {
        alert(`ü§´ Hint: ${riddles[currentRoom % riddles.length].answer}`);
      }
      showWrongEffect();
      if (Math.random() < 0.3) {
        showJumpScare();
      }
    }
  }

  function submitAnswer() {
    checkAnswer(answerInput.value);
  }

  function getClue() {
    if (clues > 0) {
      clues--;
      clueCountDisplay.textContent = clues;
      clueButtonClicksWithoutClues = 0;
      alert(`üïØ Clue: ${riddles[currentRoom % riddles.length].clue}`);
    } else {
      clueButtonClicksWithoutClues++;
      if (clueButtonClicksWithoutClues > 3) {
        alert(`üí° Answer: ${riddles[currentRoom % riddles.length].answer}`);
        clueButtonClicksWithoutClues = 0;
      } else {
        alert("‚ùå You have no clues left! Press again 3 times to reveal answer.");
      }
    }
  }

  // Start the first room's story
  displayRoom();

</script>
</body>
</html>
